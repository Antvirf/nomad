<div class="cluster-viz">
  {{!-- <ul>
    <li>Context: {{this.cluster.context}}</li>
    <li>EntityID: {{this.cluster.entityID}}</li>
    <li>Entity: {{this.cluster.entity}}</li>
  </ul>
  <hr />
  <ul>
    {{#each this.cluster.data as |data|}}
    <li>{{data}}</li>
    {{/each}}
  </ul> --}}

  <svg width="100%" height="100%"
    {{did-insert (queue
      this.sizeCanvas
      this.updateNodes
      this.setupLinks
      this.initializeSimulation
      this.setupZoom
    )}}
    {{did-update (queue (this.updateNodes this.cluster.data.length) this.setupLinks)}}
    {{window-resize this.sizeCanvas}}
  >
    <defs>
      <g id="icon-server">
        <svg xmlns="http://www.w3.org/2000/svg" width={{this.nodeRadius}} height={{this.nodeRadius}} fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 0a2.25 2.25 0 00-.75 4.372v.465a3.25 3.25 0 00-1.797 1.144l-.625-.366a2.25 2.25 0 10-1.038 1.13l1.026.602a3.261 3.261 0 000 1.306l-1.026.601a2.25 2.25 0 101.038 1.13l.625-.366a3.25 3.25 0 001.797 1.145v.465a2.25 2.25 0 101.5 0v-.465a3.25 3.25 0 001.797-1.145l.625.366a2.25 2.25 0 101.038-1.13l-1.026-.6a3.26 3.26 0 000-1.307l1.026-.601a2.25 2.25 0 10-1.038-1.13l-.625.365A3.251 3.251 0 008.75 4.837v-.465A2.25 2.25 0 008 0zm-.75 2.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM2.75 4a.75.75 0 100 1.5.75.75 0 000-1.5zm0 6.5a.75.75 0 100 1.5.75.75 0 000-1.5zm4.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zm6-3.25a.75.75 0 100 1.5.75.75 0 000-1.5zm0-6.5a.75.75 0 100 1.5.75.75 0 000-1.5zM6.395 7.3a1.75 1.75 0 113.21 1.4 1.75 1.75 0 01-3.21-1.4z" clip-rule="evenodd"/></svg>
      </g>
      <g id="icon-client">
        <svg xmlns="http://www.w3.org/2000/svg" width={{this.nodeRadius}} height={{this.nodeRadius}} fill="none" viewBox="0 0 16 16"><g fill="currentColor"><path d="M3 3.25a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5A.75.75 0 013 3.25z"/><path fill-rule="evenodd" d="M2.25 0A2.25 2.25 0 000 2.25v2.5A2.25 2.25 0 002.25 7h11.5A2.25 2.25 0 0016 4.75v-2.5A2.25 2.25 0 0013.75 0H2.25zM1.5 2.25a.75.75 0 01.75-.75h11.5a.75.75 0 01.75.75v2.5a.75.75 0 01-.75.75H2.25a.75.75 0 01-.75-.75v-2.5z" clip-rule="evenodd"/><path d="M3.75 11.5a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h-.5z"/><path fill-rule="evenodd" d="M2.25 9A2.25 2.25 0 000 11.25v2.5A2.25 2.25 0 002.25 16h11.5A2.25 2.25 0 0016 13.75v-2.5A2.25 2.25 0 0013.75 9H2.25zm-.75 2.25a.75.75 0 01.75-.75h11.5a.75.75 0 01.75.75v2.5a.75.75 0 01-.75.75H2.25a.75.75 0 01-.75-.75v-2.5z" clip-rule="evenodd"/></g></svg>
      </g>
      <g id="icon-job">
        <svg xmlns="http://www.w3.org/2000/svg" width={{this.nodeRadius}} height={{this.nodeRadius}} fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M5.75 1A1.75 1.75 0 004 2.75V4H2.25A2.25 2.25 0 000 6.25v6.5A2.25 2.25 0 002.25 15h11.5A2.25 2.25 0 0016 12.75v-6.5A2.25 2.25 0 0013.75 4H12V2.75A1.75 1.75 0 0010.25 1h-4.5zm6.75 12.5h1.25a.75.75 0 00.75-.75v-6.5a.75.75 0 00-.75-.75H12.5v8zm-1.{{this.nodeIconOffset}}8H5{{this.nodeIconOffset}}6zm-7.5 8{{this.nodeIconOffset}}2.25a.75.75 0 00-.75.75v6.5c0 .414.336.75.75.75H3.5zm7-9.5V2.75a.25.25 0 00-.25-.25h-4.5a.25.25 0 00-.25.25V4h5z" clip-rule="evenodd"/></svg>
      </g>
    </defs>

    <g class="zoom-container" width="100%" height="100%">
      <rect width="100%" height="100%" fill="transparent" />
      {{!-- {{log "AY NODES" this.nodes}} --}}
      {{!-- {{#if (and this.primaryRadius this.secondaryRadius this.tertiaryRadius this.centerX this.centerY)}}
      <circle r={{this.primaryRadius}} cx={{this.centerX}} cy={{this.centerY}} stroke="brown" stroke-opacity="0.5" fill="none"></circle>
      <circle r={{this.secondaryRadius}} cx={{this.centerX}} cy={{this.centerY}} stroke="steelblue" stroke-opacity="0.5" fill="none"></circle>
      <circle r={{this.tertiaryRadius}} cx={{this.centerX}} cy={{this.centerY}} stroke="green" stroke-opacity="0.5" fill="none"></circle>
      {{/if}} --}}
      <g class="edges">
          {{!-- {{#each this.edges as |link|}}
              <line class="link" x1={{this.nodes.[link.source].x}} y1={{this.nodes.[link.source].y}}
                    x2={{this.nodes.[link.target].x}} y2={{this.nodes.[link.target].y}}
                    stroke="gray" stroke-width="2">
              </line>
          {{/each}} --}}
        {{#each this.edges as |link|}}
            <line 
                x1={{link.source.x}} y1={{link.source.y}}
                x2={{link.target.x}} y2={{link.target.y}}
                stroke="gray"
                stroke-opacity="0.1"
                stroke-width="2">
            </line>
        {{/each}}
      </g>
      {{#each this.nodes as |node|}}
        <g
        {{!-- on hover --}}
        {{on "mouseover" (fn this.onNodeMouseOver node)}}
        data-item-type={{node.model.constructor.modelName}} transform="translate({{node.x}}, {{node.y}})">

          {{#if (eq node.model.constructor.modelName 'agent')}}
            <circle r="{{this.nodeRadius}}" fill="aliceblue" stroke="black" stoke-width="1" stroke-opacity="0.2"></circle>
            <use href="#icon-server" x={{this.nodeIconOffset}} y={{this.nodeIconOffset}} width="{{this.nodeRadius}}" height="{{this.nodeRadius}}"></use>
          {{else if (eq node.model.constructor.modelName 'node')}}
            <circle r="{{this.nodeRadius}}" fill="aliceblue" stroke="black" stoke-width="1" stroke-opacity="0.2"></circle>
            <use href="#icon-client" x={{this.nodeIconOffset}} y={{this.nodeIconOffset}} width="{{this.nodeRadius}}" height="{{this.nodeRadius}}"></use>
          {{else if (eq node.model.constructor.modelName 'job')}}
            <circle r="{{this.nodeRadius}}" fill="aliceblue" stroke="black" stoke-width="1" stroke-opacity="0.2"></circle>
            <use href="#icon-job" x={{this.nodeIconOffset}} y={{this.nodeIconOffset}} width="{{this.nodeRadius}}" height="{{this.nodeRadius}}"></use>
          {{else if (eq node.model.constructor.modelName 'allocation')}}
            <circle r="{{this.allocationRadius}}" fill={{node.color}} stroke="black" stoke-width="1" stroke-opacity="0.2"></circle>
            {{!-- <use href="#icon-job" x={{this.nodeIconOffset}} y={{this.nodeIconOffset}} width="{{this.nodeRadius}}" height="{{this.nodeRadius}}"></use> --}}
          {{else}}
              <circle r="{{this.nodeRadius}}" fill="red"></circle>
          {{/if}}
        </g>
      {{/each}}
    </g>
  </svg>

  {{!-- <div class="controls">
    <label for="chargeStrength">Charge Strength:</label>
    <input type="number" id="chargeStrength" {{on "input" this.updateChargeStrength}} value={{this.chargeStrength}}>

    <label for="boundaryBuffer">Boundary Buffer:</label>
    <input type="number" id="boundaryBuffer" {{on "input" this.updateBoundaryBuffer}} value={{this.boundaryBuffer}}>

    <label for="collisionBuffer">Collision Buffer:</label>
    <input type="number" id="collisionBuffer" {{on "input" this.updateCollisionBuffer}} value={{this.collisionBuffer}}>

    <label for="radialRadius">Radial force radius:</label>
    <input type="number" id="radialRadius" {{on "input" this.updateRadialRadius}} value={{this.radialRadius}} step="0.1">

    <label for="radialStrength">Radial Strength:</label>
    <input type="number" id="radialStrength" {{on "input" this.updateRadialStrength}} value={{this.radialStrength}} step="0.1">
  </div> --}}

</div>